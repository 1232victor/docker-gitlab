<!doctype html>
<html>
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="chrome=1">
    <title>Docker Gitlab by sameersbn</title>
    <link rel="stylesheet" href="stylesheets/styles.css">
    <link rel="stylesheet" href="stylesheets/pygment_trac.css">
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.7.1/jquery.min.js"></script>
    <script src="javascripts/respond.js"></script>
    <!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <!--[if lt IE 8]>
    <link rel="stylesheet" href="stylesheets/ie.css">
    <![endif]-->
    <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no">

  </head>
  <body>
      <div id="header">
        <nav>
          <li class="fork"><a href="https://github.com/sameersbn/docker-gitlab">View On GitHub</a></li>
          <li class="downloads"><a href="https://github.com/sameersbn/docker-gitlab/zipball/master">ZIP</a></li>
          <li class="downloads"><a href="https://github.com/sameersbn/docker-gitlab/tarball/master">TAR</a></li>
          <li class="title">DOWNLOADS</li>
        </nav>
      </div><!-- end header -->

    <div class="wrapper">

      <section>
        <div id="title">
          <h1>Docker Gitlab</h1>
          <p>GitLab dockerized on top of nginx/mysql stack</p>
          <hr>
          <span class="credits left">Project maintained by <a href="https://github.com/sameersbn">sameersbn</a></span>
          <span class="credits right">Hosted on GitHub Pages &mdash; Theme by <a href="https://twitter.com/michigangraham">mattgraham</a></span>
        </div>

        <h1>
<a name="table-of-contents" class="anchor" href="#table-of-contents"><span class="octicon octicon-link"></span></a>Table of Contents</h1>

<ul>
<li>
<a href="#introduction">Introduction</a>

<ul>
<li><a href="#version">Version</a></li>
<li><a href="Changelog.md">Changelog</a></li>
</ul>
</li>
<li>
<a href="#hardware-requirements">Hardware Requirements</a>

<ul>
<li><a href="#cpu">CPU</a></li>
<li><a href="#memory">Memory</a></li>
<li><a href="#storage">Storage</a></li>
</ul>
</li>
<li><a href="#supported-web-browsers">Supported Web Browsers</a></li>
<li><a href="#installation">Installation</a></li>
<li><a href="#quick-start">Quick Start</a></li>
<li>
<a href="#configuration">Configuration</a>

<ul>
<li><a href="#data-store">Data Store</a></li>
<li>
<a href="#database">Database</a>

<ul>
<li>
<a href="#mysql">MySQL</a>

<ul>
<li><a href="#internal-mysql-server">Internal MySQL Server</a></li>
<li><a href="#external-mysql-server">External MySQL Server</a></li>
</ul>
</li>
<li>
<a href="%24postgresql">PostgreSQL</a>

<ul>
<li><a href="#external-postgresql-server">External PostgreSQL Server</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#mail">Mail</a></li>
<li><a href="#putting-it-all-together">Putting it all together</a></li>
<li><a href="#available-configuration-parameters">Available Configuration Parameters</a></li>
</ul>
</li>
<li>
<a href="#maintenance">Maintenance</a>

<ul>
<li><a href="#ssh-login">SSH Login</a></li>
<li><a href="#creating-backups">Creating Backups</a></li>
<li><a href="#restoring-backups">Restoring Backups</a></li>
<li><a href="#automated-backups">Automated Backups</a></li>
</ul>
</li>
<li><a href="#upgrading">Upgrading</a></li>
<li><a href="#rake-tasks">Rake Tasks</a></li>
<li><a href="#references">References</a></li>
</ul><h1>
<a name="introduction" class="anchor" href="#introduction"><span class="octicon octicon-link"></span></a>Introduction</h1>

<p>Dockerfile to build a GitLab container image.</p>

<h2>
<a name="version" class="anchor" href="#version"><span class="octicon octicon-link"></span></a>Version</h2>

<p>Current Version: 6.7.2</p>

<h1>
<a name="hardware-requirements" class="anchor" href="#hardware-requirements"><span class="octicon octicon-link"></span></a>Hardware Requirements</h1>

<h2>
<a name="cpu" class="anchor" href="#cpu"><span class="octicon octicon-link"></span></a>CPU</h2>

<ul>
<li>1 core works for under 100 users but the responsiveness might suffer</li>
<li>2 cores is the recommended number of cores and supports up to 100 users</li>
<li>4 cores supports up to 1,000 users</li>
<li>8 cores supports up to 10,000 users</li>
</ul><h2>
<a name="memory" class="anchor" href="#memory"><span class="octicon octicon-link"></span></a>Memory</h2>

<ul>
<li>512MB is too little memory, GitLab will be very slow and you will need 250MB of swap</li>
<li>768MB is the minimal memory size but we advise against this</li>
<li>1GB supports up to 100 users (with individual repositories under 250MB, otherwise git memory usage necessitates using swap space)</li>
<li>
<strong>2GB</strong> is the <strong>recommended</strong> memory size and supports up to 1,000 users</li>
<li>4GB supports up to 10,000 users</li>
</ul><h2>
<a name="storage" class="anchor" href="#storage"><span class="octicon octicon-link"></span></a>Storage</h2>

<p>The necessary hard drive space largely depends on the size of the repos you want
to store in GitLab. But as a <em>rule of thumb</em> you should have at least twice as much
free space as your all repos combined take up. You need twice the storage because <a href="https://github.com/gitlabhq/gitlabhq/blob/master/doc/install/structure.md">GitLab satellites</a> contain an extra copy of each repo.</p>

<p>If you want to be flexible about growing your hard drive space in the future consider mounting it using LVM so you can add more hard drives when you need them.</p>

<p>Apart from a local hard drive you can also mount a volume that supports the network file system (NFS) protocol. This volume might be located on a file server, a network attached storage (NAS) device, a storage area network (SAN) or on an Amazon Web Services (AWS) Elastic Block Store (EBS) volume.</p>

<p>If you have enough RAM memory and a recent CPU the speed of GitLab is mainly limited by hard drive seek times. Having a fast drive (7200 RPM and up) or a solid state drive (SSD) will improve the responsiveness of GitLab.</p>

<h1>
<a name="supported-web-browsers" class="anchor" href="#supported-web-browsers"><span class="octicon octicon-link"></span></a>Supported Web Browsers</h1>

<ul>
<li>Chrome (Latest stable version)</li>
<li>Firefox (Latest released version)</li>
<li>Safari 7+ (Know problem: required fields in html5 do not work)</li>
<li>Opera (Latest released version)</li>
<li>IE 10+</li>
</ul><h1>
<a name="installation" class="anchor" href="#installation"><span class="octicon octicon-link"></span></a>Installation</h1>

<p>Pull the latest version of the image from the docker index. This is the recommended method of installation as it is easier to update image in the future. These builds are performed by the <strong>Docker Trusted Build</strong> service.</p>

<div class="highlight highlight-bash"><pre>docker pull sameersbn/gitlab
</pre></div>

<p>Since version 6.3.0, the image builds are being tagged. You can now pull a particular version of gitlab by specifying the version number. For example,</p>

<div class="highlight highlight-bash"><pre>docker pull sameersbn/gitlab:6.7.2
</pre></div>

<p>Alternately you can build the image yourself.</p>

<div class="highlight highlight-bash"><pre>git clone https://github.com/sameersbn/docker-gitlab.git
<span class="nb">cd </span>docker-gitlab
docker build -t<span class="o">=</span><span class="s2">"$USER/gitlab"</span> .
</pre></div>

<h1>
<a name="quick-start" class="anchor" href="#quick-start"><span class="octicon octicon-link"></span></a>Quick Start</h1>

<p>Run the gitlab image</p>

<div class="highlight highlight-bash"><pre>docker run -name gitlab -d sameersbn/gitlab
<span class="nv">GITLAB_IP</span><span class="o">=</span><span class="k">$(</span>docker inspect gitlab <span class="p">|</span> grep IPAddres <span class="p">|</span> awk -F<span class="s1">'"'</span> <span class="s1">'{print $4}'</span><span class="k">)</span>
</pre></div>

<p>Access the GitLab application</p>

<div class="highlight highlight-bash"><pre>xdg-open <span class="s2">"http://${GITLAB_IP}"</span>
</pre></div>

<p><strong>NOTE</strong>: Please allow a minute or two for the GitLab application to start.</p>

<p>Login using the default username and password:</p>

<ul>
<li>username: <a href="mailto:admin@local.host">admin@local.host</a>
</li>
<li>password: 5iveL!fe</li>
</ul><p>You should now have GitLab ready for testing. If you want to use GitLab for more than just testing then please read the <strong>Advanced Options</strong> section.</p>

<h1>
<a name="configuration" class="anchor" href="#configuration"><span class="octicon octicon-link"></span></a>Configuration</h1>

<h2>
<a name="data-store" class="anchor" href="#data-store"><span class="octicon octicon-link"></span></a>Data Store</h2>

<p>GitLab is a code hosting software and as such you don't want to lose your code when the docker container is stopped/deleted. To avoid losing any data, you should mount a volume at,</p>

<ul>
<li>/home/git/data</li>
</ul><p>Volumes can be mounted in docker by specifying the <strong>'-v'</strong> option in the docker run command.</p>

<div class="highlight highlight-bash"><pre>mkdir /opt/gitlab/data
docker run -name gitlab -d <span class="se">\</span>
  -v /opt/gitlab/data:/home/git/data <span class="se">\</span>
  sameersbn/gitlab
</pre></div>

<h2>
<a name="database" class="anchor" href="#database"><span class="octicon octicon-link"></span></a>Database</h2>

<p>GitLab uses a database backend to store its data.</p>

<h3>
<a name="mysql" class="anchor" href="#mysql"><span class="octicon octicon-link"></span></a>MySQL</h3>

<h4>
<a name="internal-mysql-server" class="anchor" href="#internal-mysql-server"><span class="octicon octicon-link"></span></a>Internal MySQL Server</h4>

<p>This docker image is configured to use a MySQL database backend. The database connection can be configured using environment variables. If not specified, the image will start a mysql server internally and use it. However in this case, the data stored in the mysql database will be lost if the container is stopped/deleted. To avoid this you should mount a volume at /var/lib/mysql.</p>

<div class="highlight highlight-bash"><pre>mkdir /opt/gitlab/mysql
docker run -name gitlab -d <span class="se">\</span>
  -v /opt/gitlab/data:/home/git/data <span class="se">\</span>
  -v /opt/gitlab/mysql:/var/lib/mysql sameersbn/gitlab
</pre></div>

<p>This will make sure that the data stored in the database is not lost when the image is stopped and started again.</p>

<h4>
<a name="external-mysql-server" class="anchor" href="#external-mysql-server"><span class="octicon octicon-link"></span></a>External MySQL Server</h4>

<p>The image can be configured to use an external MySQL database instead of starting a MySQL server internally. The database configuration should be specified using environment variables while starting the GitLab image.</p>

<p>Before you start the GitLab image create user and database for gitlab.</p>

<div class="highlight highlight-bash"><pre>mysql -uroot -p
CREATE USER <span class="s1">'gitlab'</span>@<span class="s1">'%.%.%.%'</span> IDENTIFIED BY <span class="s1">'password'</span><span class="p">;</span>
CREATE DATABASE IF NOT EXISTS <span class="sb">`</span>gitlabhq_production<span class="sb">`</span> DEFAULT CHARACTER SET <span class="sb">`</span>utf8<span class="sb">`</span> COLLATE <span class="sb">`</span>utf8_unicode_ci<span class="sb">`</span><span class="p">;</span>
GRANT SELECT, LOCK TABLES, INSERT, UPDATE, DELETE, CREATE, DROP, INDEX, ALTER ON <span class="sb">`</span>gitlabhq_production<span class="sb">`</span>.* TO <span class="s1">'gitlab'</span>@<span class="s1">'%.%.%.%'</span><span class="p">;</span>
</pre></div>

<p>To make sure the database is initialized start the container with <strong>app:rake gitlab:setup</strong> option.</p>

<p><strong>NOTE: This should be done only for the first run</strong>.</p>

<p><em>Assuming that the mysql server host is 192.168.1.100</em></p>

<div class="highlight highlight-bash"><pre>docker run -name gitlab -i -t -rm <span class="se">\</span>
  -e <span class="s2">"DB_HOST=192.168.1.100"</span> -e <span class="s2">"DB_NAME=gitlabhq_production"</span> -e <span class="s2">"DB_USER=gitlab"</span> -e <span class="s2">"DB_PASS=password"</span> <span class="se">\</span>
  -v /opt/gitlab/data:/home/git/data <span class="se">\</span>
  sameersbn/gitlab app:rake gitlab:setup
</pre></div>

<p>This will initialize the gitlab database. Now that the database is initialized, start the container normally.</p>

<div class="highlight highlight-bash"><pre>docker run -name gitlab -d <span class="se">\</span>
  -e <span class="s2">"DB_HOST=192.168.1.100"</span> -e <span class="s2">"DB_NAME=gitlabhq_production"</span> -e <span class="s2">"DB_USER=gitlab"</span> -e <span class="s2">"DB_PASS=password"</span> <span class="se">\</span>
  -v /opt/gitlab/data:/home/git/data <span class="se">\</span>
  sameersbn/gitlab
</pre></div>

<h3>
<a name="postgresql" class="anchor" href="#postgresql"><span class="octicon octicon-link"></span></a>PostgreSQL</h3>

<h4>
<a name="external-postgresql-server" class="anchor" href="#external-postgresql-server"><span class="octicon octicon-link"></span></a>External PostgreSQL Server</h4>

<p>The image also supports using an external PostgreSQL Server. This is also controlled via environment variables.</p>

<div class="highlight highlight-bash"><pre>createuser gitlab
createdb -O gitlab gitlabhq_production
</pre></div>

<p>To make sure the database is initialized start the container with <strong>app:rake gitlab:setup</strong> option.</p>

<p><strong>NOTE: This should be done only for the first run</strong>.</p>

<p><em>Assuming that the PostgreSQL server host is 192.168.1.100</em></p>

<div class="highlight highlight-bash"><pre>docker run -name gitlab -i -t -rm <span class="se">\</span>
  -e <span class="s2">"DB_TYPE=postgres"</span> -e <span class="s2">"DB_HOST=192.168.1.100"</span> -e <span class="s2">"DB_NAME=gitlabhq_production"</span> -e <span class="s2">"DB_USER=gitlab"</span> -e <span class="s2">"DB_PASS=password"</span> <span class="se">\</span>
  -v /opt/gitlab/data:/home/git/data <span class="se">\</span>
  sameersbn/gitlab app:rake gitlab:setup
</pre></div>

<p>This will initialize the gitlab database. Now that the database is initialized, start the container normally.</p>

<div class="highlight highlight-bash"><pre>docker run -name gitlab -d <span class="se">\</span>
  -e <span class="s2">"DB_TYPE=postgres"</span> -e <span class="s2">"DB_HOST=192.168.1.100"</span> -e <span class="s2">"DB_NAME=gitlabhq_production"</span> -e <span class="s2">"DB_USER=gitlab"</span> -e <span class="s2">"DB_PASS=password"</span> <span class="se">\</span>
  -v /opt/gitlab/data:/home/git/data <span class="se">\</span>
  sameersbn/gitlab
</pre></div>

<h3>
<a name="mail" class="anchor" href="#mail"><span class="octicon octicon-link"></span></a>Mail</h3>

<p>The mail configuration should be specified using environment variables while starting the GitLab image. The configuration defaults to using gmail to send emails and requires the specification of a valid username and password to login to the gmail servers.</p>

<p>The following environment variables need to be specified to get mail support to work.</p>

<ul>
<li>SMTP_DOMAIN (defaults to <a href="http://www.gmail.com">www.gmail.com</a>)</li>
<li>SMTP_HOST (defaults to smtp.gmail.com)</li>
<li>SMTP_PORT (defaults to 587)</li>
<li>SMTP_USER</li>
<li>SMTP_PASS</li>
<li>SMTP_STARTTLS (defaults to true)</li>
</ul><div class="highlight highlight-bash"><pre>docker run -name gitlab -d <span class="se">\</span>
  -e <span class="s2">"SMTP_USER=USER@gmail.com"</span> -e <span class="s2">"SMTP_PASS=PASSWORD"</span> <span class="se">\</span>
  -v /opt/gitlab/data:/home/git/data <span class="se">\</span>
  sameersbn/gitlab
</pre></div>

<p>If you are not using google mail, then please configure the  SMTP host and port using the SMTP_HOST and SMTP_PORT configuration parameters.</p>

<p><strong>NOTE:</strong></p>

<p>I have only tested standard gmail and google apps login. I expect that the currently provided configuration parameters should be sufficient for most users. If this is not the case, then please let me know.</p>

<h3>
<a name="putting-it-all-together" class="anchor" href="#putting-it-all-together"><span class="octicon octicon-link"></span></a>Putting it all together</h3>

<div class="highlight highlight-bash"><pre>docker run -name gitlab -d -h git.local.host <span class="se">\</span>
  -v /opt/gitlab/data:/home/git/data <span class="se">\</span>
  -v /opt/gitlab/mysql:/var/lib/mysql <span class="se">\</span>
  -e <span class="s2">"GITLAB_HOST=git.local.host"</span> -e <span class="s2">"GITLAB_EMAIL=gitlab@local.host"</span> -e <span class="s2">"GITLAB_SUPPORT=support@local.host"</span> <span class="se">\</span>
  -e <span class="s2">"SMTP_USER=USER@gmail.com"</span> -e <span class="s2">"SMTP_PASS=PASSWORD"</span> <span class="se">\</span>
  sameersbn/gitlab
</pre></div>

<p>If you are using an external mysql database</p>

<div class="highlight highlight-bash"><pre>docker run -name gitlab -d -h git.local.host <span class="se">\</span>
  -v /opt/gitlab/data:/home/git/data <span class="se">\</span>
  -e <span class="s2">"DB_HOST=192.168.1.100"</span> -e <span class="s2">"DB_NAME=gitlabhq_production"</span> -e <span class="s2">"DB_USER=gitlab"</span> -e <span class="s2">"DB_PASS=password"</span> <span class="se">\</span>
  -e <span class="s2">"GITLAB_HOST=git.local.host"</span> -e <span class="s2">"GITLAB_EMAIL=gitlab@local.host"</span> -e <span class="s2">"GITLAB_SUPPORT=support@local.host"</span> <span class="se">\</span>
  -e <span class="s2">"SMTP_USER=USER@gmail.com"</span> -e <span class="s2">"SMTP_PASS=PASSWORD"</span> <span class="se">\</span>
  sameersbn/gitlab
</pre></div>

<h3>
<a name="available-configuration-parameters" class="anchor" href="#available-configuration-parameters"><span class="octicon octicon-link"></span></a>Available Configuration Parameters</h3>

<p>Below is the complete list of available options that can be used to customize your gitlab installation.</p>

<ul>
<li>
<strong>GITLAB_HOST</strong>: The hostname of the GitLab server. Defaults to localhost</li>
<li>
<strong>GITLAB_POST</strong>: The port of the GitLab server. Defaults to 80</li>
<li>
<strong>GITLAB_EMAIL</strong>: The email address for the GitLab server. Defaults to <a href="mailto:gitlab@localhost">gitlab@localhost</a>.</li>
<li>
<strong>GITLAB_SUPPORT</strong>: The support email address for the GitLab server. Defaults to <a href="mailto:support@localhost">support@localhost</a>.</li>
<li>
<strong>GITLAB_SIGNUP</strong>: Enable or disable user signups. Default is false.</li>
<li>
<strong>GITLAB_BACKUPS</strong>: Setup cron job to automatic backups. Possible values disable, daily or monthly. Disabled by default</li>
<li>
<strong>GITLAB_BACKUP_EXPIRY</strong>: Configure how long to keep backups before they are deleted. By default when automated backups are disabled backups are kept forever (0 seconds), else the backups expire in 7 days (604800 seconds).</li>
<li>
<strong>GITLAB_SHELL_SSH_PORT</strong>: The ssh port number. Defaults to 22.</li>
<li>
<strong>REDIS_HOST</strong>: The hostname of the redis server. Defaults to localhost</li>
<li>
<strong>REDIS_PORT</strong>: The connection port of the redis server. Defaults to 6379.</li>
<li>
<strong>UNICORN_WORKERS</strong>: The number of unicorn workers to start. Defaults to 2.</li>
<li>
<strong>UNICORN_TIMEOUT</strong>: Sets the timeout of unicorn worker processes. Defaults to 60 seconds.</li>
<li>
<strong>SIDEKIQ_CONCURRENCY</strong>: The number of concurrent sidekiq jobs to run. Defaults to 5</li>
<li>
<strong>DB_TYPE</strong>: The database type. Possible values: mysql, postgres. Defaults to mysql.</li>
<li>
<strong>DB_HOST</strong>: The database server hostname. Defaults to localhost.</li>
<li>
<strong>DB_PORT</strong>: The database server port. Defaults to 3306 for mysql and 5432 for postgresql.</li>
<li>
<strong>DB_NAME</strong>: The database database name. Defaults to gitlabhq_production</li>
<li>
<strong>DB_USER</strong>: The database database user. Defaults to root</li>
<li>
<strong>DB_PASS</strong>: The database database password. Defaults to no password</li>
<li>
<strong>DB_POOL</strong>: The database database connection pool count. Defaults to 10.</li>
<li>
<strong>SMTP_DOMAIN</strong>: SMTP domain. Defaults to <a href="http://www.gmail.com">www.gmail.com</a>
</li>
<li>
<strong>SMTP_HOST</strong>: SMTP server host. Defaults to smtp.gmail.com.</li>
<li>
<strong>SMTP_PORT</strong>: SMTP server port. Defaults to 587.</li>
<li>
<strong>SMTP_USER</strong>: SMTP username.</li>
<li>
<strong>SMTP_PASS</strong>: SMTP password.</li>
<li>
<strong>SMTP_STARTTLS</strong>: Enable STARTTLS. Defaults to true.</li>
</ul><h1>
<a name="maintenance" class="anchor" href="#maintenance"><span class="octicon octicon-link"></span></a>Maintenance</h1>

<h2>
<a name="ssh-login" class="anchor" href="#ssh-login"><span class="octicon octicon-link"></span></a>SSH Login</h2>

<p>There are two methods to gain root login to the container, the first method is to add your public rsa key to the authorized_keys file and build the image.</p>

<p>The second method is use the dynamically generated password. Every time the container is started a random password is generated using the pwgen tool and assigned to the root user. This password can be fetched from the docker logs.</p>

<div class="highlight highlight-bash"><pre>docker logs gitlab 2&gt;<span class="p">&amp;</span>1 <span class="p">|</span> grep <span class="s1">'^User: '</span> <span class="p">|</span> tail -n1
</pre></div>

<p>This password is not persistent and changes every time the image is executed.</p>

<h2>
<a name="creating-backups" class="anchor" href="#creating-backups"><span class="octicon octicon-link"></span></a>Creating backups</h2>

<p>Gitlab defines a rake task to easily take a backup of your gitlab installation. The backup consists of all git repositories, uploaded files and as you might expect, the sql database.</p>

<p>Before taking a backup, please make sure that the gitlab image is not running for obvious reasons</p>

<div class="highlight highlight-bash"><pre>docker stop gitlab
</pre></div>

<p>To take a backup all you need to do is run the gitlab rake task to create a backup.</p>

<div class="highlight highlight-bash"><pre>docker run -name gitlab -i -t -rm <span class="o">[</span>OPTIONS<span class="o">]</span> <span class="se">\</span>
  sameersbn/gitlab app:rake gitlab:backup:create
</pre></div>

<p>A backup will be created in the backups folder of the <a href="#data-store">Data Store</a></p>

<h2>
<a name="restoring-backups" class="anchor" href="#restoring-backups"><span class="octicon octicon-link"></span></a>Restoring Backups</h2>

<p>Gitlab defines a rake task to easily restore a backup of your gitlab installation. Before performing the restore operation please make sure that the gitlab image is not running.</p>

<div class="highlight highlight-bash"><pre>docker stop gitlab
</pre></div>

<p>To restore a backup, run the image in interactive (-i -t) mode and pass the "app:restore" command to the container image.</p>

<div class="highlight highlight-bash"><pre>docker run -name gitlab -i -t -rm <span class="o">[</span>OPTIONS<span class="o">]</span> <span class="se">\</span>
  sameersbn/gitlab app:rake gitlab:backup:restore
</pre></div>

<p>The restore operation will list all available backups in reverse chronological order. Select the backup you want to restore and gitlab will do its job.</p>

<h2>
<a name="automated-backups" class="anchor" href="#automated-backups"><span class="octicon octicon-link"></span></a>Automated Backups</h2>

<p>The image can be configured to automatically take backups on a daily or monthly basis. Adding -e "GITLAB_BACKUPS=daily" to the docker run command will enable daily backups, while -e "GITLAB_BACKUPS=monthly" will enable monthly backups.</p>

<p>Daily backups are created at 4 am (UTC) everyday, while monthly backups are created on the 1st of every month at the same time as the daily backups.</p>

<p>By default, when automated backups are enabled, backups are held for a period of 7 days. While when automated backups are disabled, the backups are held for an infinite period of time. This can behaviour can be configured via the GITLAB_BACKUP_EXPIRY option.</p>

<h1>
<a name="upgrading" class="anchor" href="#upgrading"><span class="octicon octicon-link"></span></a>Upgrading</h1>

<p>GitLabHQ releases new versions on the 22nd of every month, bugfix releases immediately follow. I update this project almost immediately when a release is made (at least it has been the case so far). If you are using the image in production environments I recommend that you delay updates by a couple of days after the gitlab release, allowing some time for the dust to settle down.</p>

<p>To upgrade to newer gitlab releases, simply follow this 5 step upgrade procedure.</p>

<ul>
<li>
<strong>Step 1</strong>: Stop the currently running image</li>
</ul><div class="highlight highlight-bash"><pre>docker stop gitlab
</pre></div>

<ul>
<li>
<strong>Step 2</strong>: Backup the application data.</li>
</ul><div class="highlight highlight-bash"><pre>docker run -name gitlab -i -t -rm <span class="o">[</span>OPTIONS<span class="o">]</span> <span class="se">\</span>
  sameersbn/gitlab app:rake gitlab:backup:create
</pre></div>

<ul>
<li>
<strong>Step 3</strong>: Update the docker image.</li>
</ul><div class="highlight highlight-bash"><pre>docker pull sameersbn/gitlab
</pre></div>

<ul>
<li>
<strong>Step 4</strong>: Migrate the database.</li>
</ul><div class="highlight highlight-bash"><pre>docker run -name gitlab -i -t -rm <span class="o">[</span>OPTIONS<span class="o">]</span> <span class="se">\</span>
  sameersbn/gitlab app:rake db:migrate
</pre></div>

<ul>
<li>
<strong>Step 5</strong>: Start the image</li>
</ul><div class="highlight highlight-bash"><pre>docker run -name gitlab -d <span class="o">[</span>OPTIONS<span class="o">]</span> sameersbn/gitlab
</pre></div>

<h2>
<a name="rake-tasks" class="anchor" href="#rake-tasks"><span class="octicon octicon-link"></span></a>Rake Tasks</h2>

<p>The app:rake command allows you to run gitlab rake tasks. To run a rake task simply specify the task to be executed to the app:rake command. For example, if you want to gather information about GitLab and the system it runs on.</p>

<div class="highlight highlight-bash"><pre>docker run -name gitlab -d <span class="o">[</span>OPTIONS<span class="o">]</span> <span class="se">\</span>
  sameersbn/gitlab app:rake gitlab:env:info
</pre></div>

<p>Similarly, to import bare repositories into GitLab project instance</p>

<div class="highlight highlight-bash"><pre>docker run -name gitlab -d <span class="o">[</span>OPTIONS<span class="o">]</span> <span class="se">\</span>
  sameersbn/gitlab app:rake gitlab:import:repos
</pre></div>

<p>For a complete list of available rake tasks please refer <a href="https://github.com/gitlabhq/gitlabhq/tree/master/doc/raketasks">https://github.com/gitlabhq/gitlabhq/tree/master/doc/raketasks</a> or the help section of your gitlab installation.</p>

<h2>
<a name="references" class="anchor" href="#references"><span class="octicon octicon-link"></span></a>References</h2>

<ul>
<li><a href="https://github.com/gitlabhq/gitlabhq">https://github.com/gitlabhq/gitlabhq</a></li>
<li><a href="https://github.com/gitlabhq/gitlabhq/blob/master/doc/install/installation.md">https://github.com/gitlabhq/gitlabhq/blob/master/doc/install/installation.md</a></li>
<li><a href="https://github.com/gitlabhq/gitlabhq/blob/master/doc/install/requirements.md">https://github.com/gitlabhq/gitlabhq/blob/master/doc/install/requirements.md</a></li>
</ul>
      </section>

    </div>
    <!--[if !IE]><script>fixScale(document);</script><![endif]-->
              <script type="text/javascript">
            var gaJsHost = (("https:" == document.location.protocol) ? "https://ssl." : "http://www.");
            document.write(unescape("%3Cscript src='" + gaJsHost + "google-analytics.com/ga.js' type='text/javascript'%3E%3C/script%3E"));
          </script>
          <script type="text/javascript">
            try {
              var pageTracker = _gat._getTracker("UA-48810494-2");
            pageTracker._trackPageview();
            } catch(err) {}
          </script>

  </body>
</html>